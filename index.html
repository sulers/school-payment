<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>School Payment Management System</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="container">
      <header>
        <h1>üè´ School Payment Management System</h1>
        <p>Track and manage student payments efficiently</p>

        <div class="header-controls">
          <div class="controls">
            <button class="btn btn-primary" onclick="openAddClassModal()">
              <span>+</span> Add Class
            </button>
            <button class="btn btn-success" onclick="openAddStudentModal()">
              <span>+</span> Add Student
            </button>
            <button class="btn btn-info" onclick="exportData()">
              üì• Export Data
            </button>
            <button class="btn btn-purple" onclick="openImportModal()">
              üì§ Import Data
            </button>
          </div>

          <div class="school-info">
            <div id="currentDate"></div>
            <div
              id="totalEarnings"
              class="stat-card"
              style="
                display: inline-block;
                padding: 10px 15px;
                margin-top: 10px;
              "
            >
              <strong>Total Collected: üíµ0.00</strong>
            </div>
          </div>
        </div>

        <!-- Export Controls -->
        <div class="export-controls">
          <div class="filter-group">
            <label for="dataFormat">Export Format:</label>
            <select id="dataFormat">
              <option value="full">Full Data (Backup)</option>
              <option value="students">Students Only</option>
              <option value="classes">Classes Only</option>
              <option value="summary">Summary Report</option>
            </select>
          </div>
          <div class="filter-group">
            <label for="includeStats">Include Stats:</label>
            <select id="includeStats">
              <option value="true">Yes</option>
              <option value="false">No</option>
            </select>
          </div>
        </div>
      </header>

      <div class="filters">
        <div class="filter-group">
          <label for="classFilter">Filter by Class</label>
          <select id="classFilter" onchange="filterStudents()">
            <option value="">All Classes</option>
          </select>
        </div>

        <div class="filter-group">
          <label for="paymentFilter">Filter by Payment Status</label>
          <select id="paymentFilter" onchange="filterStudents()">
            <option value="">All Students</option>
            <option value="paid">Fully Paid</option>
            <option value="unpaid">Has Unpaid Months</option>
            <option value="partial">Partially Paid</option>
          </select>
        </div>

        <div class="filter-group">
          <label for="searchFilter">Search Student</label>
          <input
            type="text"
            id="searchFilter"
            placeholder="Enter student name..."
            onkeyup="filterStudents()"
          />
        </div>
      </div>

      <!-- Monthly Earnings Stats -->
      <div class="stats" id="monthlyStats">
        <!-- Monthly stats will be populated here -->
      </div>

      <div class="students-table">
        <table>
          <thead>
            <tr>
              <th>Student Name</th>
              <th>Class</th>
              <th>Monthly Fee</th>
              <th>Paid Months</th>
              <th>Total Paid</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="studentsTableBody">
            <!-- Students will be populated here -->
          </tbody>
        </table>
      </div>

      <!-- Instructions Section -->
      <div class="instructions">
        <h3>üìã How to Use the System</h3>
        <ul>
          <li>
            <strong>Add Classes:</strong> Create classes before adding students
          </li>
          <li>
            <strong>Add Students:</strong> Register students with their name and
            class
          </li>
          <li>
            <strong>Set Individual Fees:</strong> Each student can have their
            own monthly fee
          </li>
          <li>
            <strong>Mark Payments:</strong> Click on a student to view and mark
            monthly payments
          </li>
          <li>
            <strong>All 12 Months:</strong> You can track payments for all 12
            months of the year
          </li>
          <li>
            <strong>Earnings by Month:</strong> See total collected for each
            month at the top
          </li>
          <li>
            <strong>Export Data:</strong> Use the Export Data button to backup
            all information
          </li>
          <li>
            <strong>Import Data:</strong> Use the Import Data button to restore
            from backup
          </li>
          <li>
            <strong>Filters:</strong> Use filters to find specific students or
            payment status
          </li>
          <li>
            <strong>Edit/Delete:</strong> Use action buttons to edit or delete
            student records
          </li>
        </ul>
        <p>
          <strong>Note:</strong> When updating fees, old paid months keep their
          original amount for accurate accounting.
        </p>
      </div>
    </div>

    <!-- Import Data Modal -->
    <div id="importModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Import Data from Backup</h2>
          <button class="close-btn" onclick="closeModal('importModal')">
            √ó
          </button>
        </div>
        <div class="modal-body">
          <div class="file-upload" id="fileUploadArea">
            <div
              class="file-upload-label"
              onclick="document.getElementById('fileInput').click()"
            >
              <div>üìÅ</div>
              <div>
                <strong>Click to select backup file</strong>
                <p>or drag and drop your JSON file here</p>
              </div>
            </div>
            <input
              type="file"
              id="fileInput"
              accept=".json"
              onchange="handleFileSelect(event)"
            />
          </div>

          <div id="fileInfo" style="display: none; margin-top: 20px">
            <div class="form-group">
              <label>Selected File:</label>
              <div
                id="fileName"
                style="
                  padding: 10px;
                  background: var(--light);
                  border-radius: 6px;
                "
              ></div>
            </div>
          </div>

          <div
            id="validationResult"
            class="validation-message"
            style="display: none"
          ></div>

          <div id="previewSection" style="display: none">
            <h4>Data Preview:</h4>
            <div class="preview-box" id="previewContent">
              <!-- Preview will be shown here -->
            </div>
          </div>

          <div id="importOptions" style="display: none; margin-top: 20px">
            <h4>Import Options:</h4>
            <div class="import-options">
              <div
                class="import-option"
                onclick="selectImportOption('replace')"
                id="replaceOption"
              >
                <h4>üîÑ Replace All Data</h4>
                <p>Clear all existing data and replace with imported data</p>
              </div>
              <div
                class="import-option"
                onclick="selectImportOption('merge')"
                id="mergeOption"
              >
                <h4>üîÄ Merge Data</h4>
                <p>Keep existing data and add imported data</p>
              </div>
            </div>
          </div>

          <div style="text-align: right; margin-top: 30px">
            <button
              class="btn btn-danger"
              onclick="closeModal('importModal')"
              style="margin-right: 10px"
            >
              Cancel
            </button>
            <button
              class="btn btn-success"
              onclick="executeImport()"
              id="importButton"
              disabled
            >
              Import Data
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Student Details Modal -->
    <div id="studentModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="modalTitle">Student Details</h2>
          <button class="close-btn" onclick="closeModal('studentModal')">
            √ó
          </button>
        </div>
        <div class="modal-body">
          <div class="student-info">
            <div class="info-group">
              <label>Student Name</label>
              <h3 id="modalStudentName">-</h3>
            </div>
            <div class="info-group">
              <label>Class</label>
              <h3 id="modalStudentClass">-</h3>
            </div>
            <div class="info-group">
              <label>Monthly Fee</label>
              <div class="fee-input-container">
                <input
                  type="number"
                  id="studentMonthlyFee"
                  min="0"
                  step="0.01"
                  placeholder="Enter monthly fee"
                />
                <button class="btn btn-primary" onclick="updateStudentFee()">
                  Update
                </button>
              </div>
            </div>
            <div class="info-group">
              <label>Total Paid</label>
              <h3 id="modalTotalPaid">üíµ0.00</h3>
            </div>
          </div>

          <h4>Monthly Payment Tracking</h4>
          <p>Click on any month to toggle payment status.</p>

          <div class="month-grid" id="monthGrid">
            <!-- All 12 months will be populated here -->
          </div>
        </div>
      </div>
    </div>

    <!-- Add Student Modal -->
    <div id="addStudentModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Add New Student</h2>
          <button class="close-btn" onclick="closeModal('addStudentModal')">
            √ó
          </button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="studentName">Student Name</label>
            <input
              type="text"
              id="studentName"
              placeholder="Enter student name"
            />
          </div>

          <div class="form-group">
            <label for="studentClass">Select Class</label>
            <select id="studentClass">
              <option value="">Select a class</option>
            </select>
          </div>

          <div class="form-group">
            <label for="initialFee">Monthly Fee (üíµ)</label>
            <input
              type="number"
              id="initialFee"
              min="0"
              step="0.01"
              value="20000"
              placeholder="Enter monthly fee"
            />
          </div>

          <div style="text-align: right; margin-top: 20px">
            <button class="btn btn-primary" onclick="saveStudent()">
              Save Student
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Add Class Modal -->
    <div id="addClassModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Add New Class</h2>
          <button class="close-btn" onclick="closeModal('addClassModal')">
            √ó
          </button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="className">Class Name</label>
            <input
              type="text"
              id="className"
              placeholder="Enter class name (e.g., Grade 5A)"
            />
          </div>

          <div style="text-align: right; margin-top: 20px">
            <button class="btn btn-primary" onclick="saveClass()">
              Save Class
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Edit Student Modal -->
    <div id="editStudentModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Edit Student</h2>
          <button class="close-btn" onclick="closeModal('editStudentModal')">
            √ó
          </button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="editStudentName">Student Name</label>
            <input
              type="text"
              id="editStudentName"
              placeholder="Enter student name"
            />
          </div>

          <div class="form-group">
            <label for="editStudentClass">Select Class</label>
            <select id="editStudentClass">
              <option value="">Select a class</option>
            </select>
          </div>

          <div style="text-align: right; margin-top: 20px">
            <button
              class="btn btn-danger"
              onclick="deleteStudent()"
              style="float: left"
            >
              Delete Student
            </button>
            <button class="btn btn-primary" onclick="updateStudent()">
              Update Student
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <script src="script.js"></script>
  </body>
</html>
